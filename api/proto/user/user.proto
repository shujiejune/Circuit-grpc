// Define the protocol buffer version
syntax = "proto3";

// Specify the package to prevent name clashes
package user;

// Import necessary well-known types
import "google/protobuf/timestamp.proto";

// Specify the Go package path for the generated code
option go_package = "laas/api/proto/user";

// The UserService defines all the RPCs (Remote Procedure Calls) for managing
// users.
service UserService {
  // Auth
  rpc Signup(SignupRequest) returns (AuthResponse);
  rpc LoginUser(LoginRequest) returns (AuthResponse);
  rpc ActivateAccount(ActivateAccountRequest) returns (AuthResponse);
  rpc ResendActivationEmail(ResendActivationEmailRequest) returns (GenericResponse);
  rpc RequestPasswordReset(RequestPasswordResetRequest) returns (GenericResponse);
  rpc ResetPassword(ResetPasswordRequest) returns (AuthResponse);

  // Profile
  rpc GetUserProfile(GetUserProfileRequest) returns (UserProfileResponse);
  rpc UpdateUserProfile(UpdateUserProfileRequest) returns (UserProfileResponse);

  // Addresses
  rpc AddAddress(AddAddressRequest) returns (AddressResponse);
  rpc ListAddresses(ListAddressesRequest) returns (ListAddressesResponse);
  rpc UpdateAddress(UpdateAddressRequest) returns (AddressResponse);
  rpc DeleteAddress(DeleteAddressRequest) returns (GenericResponse);
}

// --- User Model ---
message User {
  string id = 1;
  string nickname = 2;
  string email = 3;
  string avatar_url = 4;
  string auth_provider = 5;
  bool is_active = 6;
  Role role = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

enum Role {
  ROLE_USER = 0;
  ROLE_ADMIN = 1;
}

// --- Common Messages ---
message AuthResponse {
  string access_token = 1;
  string refresh_token = 2;
  User user = 3;
}

message GenericResponse {
  bool success = 1;
  string message = 2;
}

message Address {
  string id = 1;
  string label = 2;
  string street_address = 3;
  bool is_default = 4;
}

// --- RPC-specific Messages ---

message SignupRequest {
  string name = 1;
  string email = 2;
  string password = 3;
}

message SignupResponse {
  string id = 1;
  string name = 2;
  string email = 3;
  google.protobuf.Timestamp created_at = 4;
}

message LoginRequest {
  string email = 1;
  string password = 2;
}

message LoginResponse {
  string access_token = 1; // The JWT
  string refresh_token = 2;
  User user = 3;
}

message ActivateAccountRequest {
  string token = 1;
}

message ResendActivationEmailRequest {
  string email = 1;
}

message RequestPasswordResetRequest {
  string email = 1;
}

message ResetPasswordRequest {
  string token = 1;
  string new_password = 2;
}

message GetUserProfileRequest {
  string user_id = 1;
}

message UserProfileResponse {
  string id = 1;
  string name = 2;
  string email = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
}

message UpdateUserProfileRequest {
  string user_id = 1;
  string name = 2;
}

message AddAddressRequest {
  string user_id = 1;
  string label = 2;
  string street_address = 3;
  bool is_default = 4;
}

message AddressResponse {
  Address address = 1;
}

message ListAddressesRequest {
  string user_id = 1;
  int32 page = 2; // The requested page number
  int32 limit = 3; // The number of items per page
}

message ListAddressesResponse {
  repeated Address addresses = 1;
}

message UpdateAddressRequest {
  string user_id = 1;
  string address_id = 2;
  string label = 3;
  string street_address = 4;
  bool is_default = 5; // Note: gRPC doesn't have optional primitives. The
  // client must always send a value.
}

message DeleteAddressRequest {
  string user_id = 1;
  string address_id = 2;
}
